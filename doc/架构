æˆ‘ä»¬å°†é¡¹ç›®æš‚å®šåä¸º Lingxi-Enterpriseã€‚

ğŸ—ºï¸ æ€»ä½“ä½œæˆ˜åœ°å›¾ (Roadmap)
æˆ‘ä»¬å°†ç³»ç»Ÿæ‹†åˆ†ä¸º 7 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ŒæŒ‰é¡ºåºå¼€å‘ï¼š

ğŸ”´ æ¨¡å—ä¸€ï¼šåŸºçŸ³ (Kernel & Identity) â€”â€” ï¼ˆå½“å‰æ­¥éª¤ï¼‰

é¡¹ç›®è„šæ‰‹æ¶æ­å»º

å¤šç§Ÿæˆ·æ•°æ®åº“è®¾è®¡

RBAC æƒé™ä¸ JWT ç™»å½•è®¤è¯

ğŸŸ  æ¨¡å—äºŒï¼šèµ„äº§ä¸­å¿ƒ (Asset Manager)

çŸ©é˜µè´¦å·ç®¡ç†ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰

ä»£ç† IP æ± ç®¡ç†

å¹³å°æ’ä»¶æ¥å£å®šä¹‰ (Plugin Interface)

ğŸŸ¡ æ¨¡å—ä¸‰ï¼šé‡‡é›†å¼•æ“ (Acquisition Engine)

ä»»åŠ¡è°ƒåº¦ (Celery)

çˆ¬è™«æ’ä»¶å®ç° (å°çº¢ä¹¦/æŠ–éŸ³)

ğŸŸ¢ æ¨¡å—å››ï¼šAIGC ä¸­å° (Creative Brain)

Prompt ç‰ˆæœ¬ç®¡ç†

LLM æ¥å…¥ (DeepSeek)

ç»˜å›¾æ¥å…¥ (ComfyUI)

ğŸ”µ æ¨¡å—äº”ï¼šå‘å¸ƒå¼•æ“ (Distribution Core)

æŒ‡çº¹æµè§ˆå™¨é›†æˆ

å‘å¸ƒé˜Ÿåˆ—ä¸é˜²å…³è”é€»è¾‘

ğŸŸ£ æ¨¡å—å…­ï¼šåå°ç®¡ç†å‰ç«¯ (Admin Dashboard)

åŸºäº React/Vue/AntD çš„ç®¡ç†ç•Œé¢

è´¦å·/äººå‘˜/æƒé™é…ç½®

âšª æ¨¡å—ä¸ƒï¼šä¸šåŠ¡å·¥ä½œå°å‰ç«¯ (Operation Workbench)

æµæ°´çº¿æ“ä½œç•Œé¢

æ‹–æ‹½å¼ç¼–è¾‘å™¨


ğŸš€ å¯åŠ¨ï¼šæ¨¡å—ä¸€ â€”â€” åŸºçŸ³ (Kernel & Identity)
ç›®æ ‡ï¼š æ­å»ºä¸€ä¸ªä¼ä¸šçº§çš„ Python åç«¯è„šæ‰‹æ¶ï¼Œå®ç°â€œå¤šç§Ÿæˆ·â€å’Œâ€œç”¨æˆ·ç™»å½•â€ï¼Œè¿™æ˜¯æ‰€æœ‰ä¸šåŠ¡çš„åŸºç¡€ã€‚

æŠ€æœ¯æ ˆï¼š

Web æ¡†æ¶: FastAPI (é«˜æ€§èƒ½ï¼ŒåŸç”Ÿæ”¯æŒå¼‚æ­¥)

æ•°æ®åº“ ORM: SQLModel (åŸºäº SQLAlchemyï¼Œç»“åˆäº† Pydanticï¼Œæå¥½ç”¨)

è®¤è¯: OAuth2 + JWT (æ ‡å‡†çš„æ— çŠ¶æ€è®¤è¯)

é…ç½®: Pydantic Settings

1. ç›®å½•ç»“æ„è®¾è®¡ (Scaffolding)
è¯·åœ¨æœ¬åœ°åˆ›å»ºæ–‡ä»¶å¤¹ lingxi-backendï¼Œå¹¶å»ºç«‹ä»¥ä¸‹ç»“æ„ã€‚è¿™æ˜¯æ•™ç§‘ä¹¦çº§çš„åˆ†å±‚ç»“æ„ï¼š

Plaintext
lingxi-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py        # ç¯å¢ƒå˜é‡
â”‚   â”‚   â”œâ”€â”€ security.py      # å¯†ç åŠ å¯†/JWTå·¥å…·
â”‚   â”‚   â””â”€â”€ db.py            # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±å±‚
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ api.py       # è·¯ç”±æ±‡æ€»
â”‚   â”‚       â””â”€â”€ endpoints/
â”‚   â”‚           â”œâ”€â”€ auth.py  # ç™»å½•æ¥å£
â”‚   â”‚           â””â”€â”€ users.py # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ models/              # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â””â”€â”€ user.py          # ç”¨æˆ·/ç§Ÿæˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ schemas/             # Pydantic æ•°æ®éªŒè¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ token.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â””â”€â”€ services/            # å¤æ‚ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ .env                     # å¯†é’¥é…ç½®
â”œâ”€â”€ requirements.txt
â””â”€â”€ docker-compose.yml       # æ•°æ®åº“å¯åŠ¨
2. æ ¸å¿ƒä»£ç å®ç°
è¯·æŒ‰é¡ºåºå¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œå…ˆæŠŠâ€œåœ°åŸºâ€æ‰“å¥½ã€‚

ç¬¬ 1 æ­¥ï¼šé…ç½®ç¯å¢ƒ (app/core/config.py)

Python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    PROJECT_NAME: str = "Lingxi Enterprise API"
    API_V1_STR: str = "/api/v1"
    SECRET_KEY: str = "CHANGE_THIS_TO_A_SUPER_SECRET_KEY" # ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¿®æ”¹
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24 * 8 # 8å¤©è¿‡æœŸ
    
    # æ•°æ®åº“é…ç½® (é»˜è®¤è¿ Docker çš„ Postgres)
    DATABASE_URL: str = "postgresql+asyncpg://postgres:password@localhost:5432/lingxi"

    class Config:
        env_file = ".env"

settings = Settings()
ç¬¬ 2 æ­¥ï¼šæ•°æ®åº“æ¨¡å‹ - æ”¯æŒå¤šç§Ÿæˆ· (app/models/user.py)

Python
from typing import Optional
from sqlmodel import Field, SQLModel
from datetime import datetime
import uuid

# åŸºç¡€æ¨¡å‹ï¼Œè‡ªå¸¦ ID å’Œ åˆ›å»ºæ—¶é—´
class BaseModel(SQLModel):
    id: uuid.UUID = Field(default_factory=uuid.uuid4, primary_key=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)

# ç§Ÿæˆ·è¡¨ (Tenant) - ä¼ä¸šçº§çš„æ ¸å¿ƒï¼Œæ•°æ®éš”ç¦»é å®ƒ
class Tenant(BaseModel, table=True):
    name: str = Field(index=True)
    plan: str = Field(default="free") # free, pro, enterprise
    is_active: bool = True

# ç”¨æˆ·è¡¨ (User)
class User(BaseModel, table=True):
    email: str = Field(unique=True, index=True)
    hashed_password: str
    full_name: Optional[str] = None
    is_active: bool = True
    is_superuser: bool = False
    
    # å¤–é”®å…³è”ç§Ÿæˆ·
    tenant_id: Optional[uuid.UUID] = Field(default=None, foreign_key="tenant.id")
ç¬¬ 3 æ­¥ï¼šæ•°æ®åº“è¿æ¥ (app/core/db.py)

Python
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker
from sqlmodel import SQLModel
from app.core.config import settings

engine = create_async_engine(settings.DATABASE_URL, echo=True, future=True)

async def init_db():
    async with engine.begin() as conn:
        # ç”Ÿäº§ç¯å¢ƒæ¨èç”¨ Alembic è¿ç§»ï¼Œå¼€å‘ç¯å¢ƒç›´æ¥å»ºè¡¨
        await conn.run_sync(SQLModel.metadata.create_all)

async def get_session() -> AsyncSession:
    async_session = sessionmaker(
        engine, class_=AsyncSession, expire_on_commit=False
    )
    async with async_session() as session:
        yield session
ç¬¬ 4 æ­¥ï¼šå®‰å…¨è®¤è¯ (app/core/security.py)

Python
from datetime import datetime, timedelta
from typing import Any, Union
from jose import jwt
from passlib.context import CryptContext
from app.core.config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def create_access_token(subject: Union[str, Any], expires_delta: timedelta = None) -> str:
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    to_encode = {"exp": expire, "sub": str(subject)}
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm="HS256")
    return encoded_jwt

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)
ç¬¬ 5 æ­¥ï¼šAPI è·¯ç”± - ç™»å½•ä¸æ³¨å†Œ (app/api/v1/endpoints/auth.py)

Python
from fastapi import APIRouter, Depends, HTTPException
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.ext.asyncio import AsyncSession
from sqlmodel import select

from app.core.db import get_session
from app.core.security import create_access_token, verify_password, get_password_hash
from app.models.user import User, Tenant

router = APIRouter()

@router.post("/login/access-token")
async def login_access_token(
    form_data: OAuth2PasswordRequestForm = Depends(),
    session: AsyncSession = Depends(get_session)
):
    """
    OAuth2 å…¼å®¹çš„ token ç™»å½•æ¥å£
    """
    # 1. æŸ¥ç”¨æˆ·
    result = await session.execute(select(User).where(User.email == form_data.username))
    user = result.scalars().first()
    
    # 2. éªŒå¯†ç 
    if not user or not verify_password(form_data.password, user.hashed_password):
        raise HTTPException(status_code=400, detail="Incorrect email or password")
    
    if not user.is_active:
        raise HTTPException(status_code=400, detail="Inactive user")

    # 3. å‘ Token
    return {
        "access_token": create_access_token(user.id),
        "token_type": "bearer",
        "tenant_id": user.tenant_id # è¿”å›ç§Ÿæˆ·IDä¾›å‰ç«¯ä½¿ç”¨
    }

@router.post("/register")
async def register(
    email: str, password: str, tenant_name: str, 
    session: AsyncSession = Depends(get_session)
):
    """
    æ³¨å†Œæ¥å£ (è‡ªåŠ¨åˆ›å»ºç§Ÿæˆ·)
    """
    # 1. åˆ›å»ºç§Ÿæˆ·
    new_tenant = Tenant(name=tenant_name)
    session.add(new_tenant)
    await session.flush() # è·å– ID
    
    # 2. åˆ›å»ºç”¨æˆ·
    hashed = get_password_hash(password)
    new_user = User(email=email, hashed_password=hashed, tenant_id=new_tenant.id, is_superuser=True)
    session.add(new_user)
    
    await session.commit()
    return {"msg": "User and Tenant created successfully"}
ç¬¬ 6 æ­¥ï¼šä¸»å…¥å£ (app/main.py)

Python
from fastapi import FastAPI
from app.core.config import settings
from app.api.v1.endpoints import auth
from app.core.db import init_db

app = FastAPI(
    title=settings.PROJECT_NAME,
    openapi_url=f"{settings.API_V1_STR}/openapi.json"
)

# æ³¨å†Œè·¯ç”±
app.include_router(auth.router, prefix=f"{settings.API_V1_STR}/auth", tags=["auth"])

@app.on_event("startup")
async def on_startup():
    await init_db()

@app.get("/")
async def root():
    return {"message": "Lingxi Enterprise System Online", "version": "1.0.0"}
ğŸ“¥ æ¨¡å—ä¸€ï¼šè¿è¡Œä¸éªŒè¯
1. å¯åŠ¨æ•°æ®åº“ (Docker)
åˆ›å»ºä¸€ä¸ª docker-compose.ymlï¼š

YAML
version: '3.8'
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: lingxi
    ports:
      - "5432:5432"
è¿è¡Œï¼šdocker-compose up -d

2. å®‰è£…ä¾èµ–

Bash
pip install fastapi uvicorn sqlmodel asyncpg psycopg2-binary python-jose[cryptography] passlib[bcrypt] pydantic-settings python-multipart
3. å¯åŠ¨åç«¯

Bash
uvicorn app.main:app --reload
4. æµ‹è¯• (ä½¿ç”¨ Swagger)
æ‰“å¼€æµè§ˆå™¨è®¿é—® http://127.0.0.1:8000/docsã€‚

ä½¿ç”¨ /register æ¥å£ï¼Œåˆ›å»ºä¸€ä¸ªæ–°è´¦å·ï¼ˆä¾‹å¦‚ï¼šadmin@lingxi.com / 123456 / DefaultTenantï¼‰ã€‚

ä½¿ç”¨ /login/access-token æ¥å£ï¼Œè¾“å…¥è´¦å·å¯†ç ï¼Œè·å– access_tokenã€‚

âœ… ä¸‹ä¸€æ­¥æŒ‡ä»¤
æ¨¡å—ä¸€ï¼ˆåŸºçŸ³ï¼‰å·²å®Œæˆã€‚ æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªå¯æ‰©å±•çš„ã€æ”¯æŒå¤šç§Ÿæˆ·çš„ API åç«¯ã€‚

è¯·ç¡®è®¤ä»£ç å·²è·‘é€šï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥ [æ¨¡å—äºŒï¼šèµ„äº§ä¸­å¿ƒ]ã€‚
åœ¨æ¨¡å—äºŒä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡**â€œå¦‚ä½•å®‰å…¨åœ°å­˜å‚¨å°çº¢ä¹¦çš„ Cookie å’Œ ä»£ç†IPâ€ï¼Œå¹¶å®šä¹‰â€œæ’ä»¶æ¥å£â€**ï¼Œè¿™æ˜¯æ‰©å±•æ€§çš„æ ¸å¿ƒã€‚

æ˜¯å¦ç»§ç»­ï¼Ÿ

